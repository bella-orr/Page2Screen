<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <body>
    <!-- add review -->
    <div th:fragment="add-review">
      <div class="add-review" id="add-review">
        <div>You haven't reviewed this Title!</div>
        <br />
        <button type="button" id="add-review-btn" class="btn btn-primary">
          Add a Review
        </button>
      </div>
    </div>
    <!-- view review -->
    <div th:fragment="view-review">
      <div class="view-review" id="view-review">
        <div class="review-header">
          <h2
            th:text="${currentUserReview != null ? currentUserReview.title : 'Review Title'}"
          >
            Review Title
          </h2>
          <div
            th:replace="fragments/stars :: review-stars(${currentUserReview != null ? currentUserReview.rating : 0})"
          ></div>
        </div>
        <p
          class="review-content"
          th:text="${currentUserReview != null ? currentUserReview.body : 'Review content goes here.'}"
        >
          Review content goes here.
        </p>
        <div class="review-footer">
          <button
            type="button"
            id="view-edit-btn"
            class="btn btn-primary"
            th:if="${currentUserReview != null}"
          >
            Edit Review
          </button>
          <button
            type="button"
            id="view-delete-btn"
            class="btn btn-danger"
            th:if="${currentUserReview != null}"
          >
            Delete Review
          </button>
        </div>
      </div>
    </div>
    <!-- edit review -->
    <div th:fragment="edit-review">
      <div class="edit-review" id="edit-review">
        <form id="edit-review-form">
          <fieldset>
            <legend>Edit Review</legend>

            <div class="form-row">
              <label for="review-title">Review Title:</label>
              <input
                type="text"
                id="review-title"
                name="title"
                placeholder="Enter review title"
                th:value="${currentUserReview != null ? currentUserReview.title : ''}"
              />
              <span class="error-message" aria-live="polite"></span>
            </div>

            <div class="form-row">
              <label for="review-rating">Rating:</label>
              <select id="review-rating" name="rating">
                <option
                  th:value="0"
                  th:selected="${currentUserReview != null and currentUserReview.rating == 0}"
                >
                  0
                </option>
                <option
                  th:value="1"
                  th:selected="${currentUserReview != null and currentUserReview.rating == 1}"
                >
                  1
                </option>
                <option
                  th:value="2"
                  th:selected="${currentUserReview != null and currentUserReview.rating == 2}"
                >
                  2
                </option>
                <option
                  th:value="3"
                  th:selected="${currentUserReview != null and currentUserReview.rating == 3}"
                >
                  3
                </option>
                <option
                  th:value="4"
                  th:selected="${currentUserReview != null and currentUserReview.rating == 4}"
                >
                  4
                </option>
                <option
                  th:value="5"
                  th:selected="${currentUserReview != null and currentUserReview.rating == 5}"
                >
                  5
                </option>
              </select>
              <span class="error-message" aria-live="polite"></span>
            </div>

            <div class="form-row">
              <label for="review-body">Review Body:</label>
              <textarea
                id="review-body"
                name="body"
                rows="6"
                placeholder="Write your review here..."
                th:text="${currentUserReview != null ? currentUserReview.body : ''}"
              ></textarea>
              <span class="error-message" aria-live="polite"></span>
            </div>

            <div class="form-actions">
              <button type="button" id="edit-cancel-btn" class="btn">
                Cancel
              </button>
              <button
                type="submit"
                id="edit-submit-btn"
                class="btn btn-primary"
              >
                Submit Review
              </button>
              <button type="button" id="edit-delete-btn" class="btn btn-danger">
                Delete Review
              </button>
            </div>
          </fieldset>
        </form>
      </div>
    </div>
    <!-- other reviews: accepts a 'review' param and hides if review is by current user -->
    <div th:fragment="review-preview(review)">
      <div
        class="review-preview"
        th:if="${review != null and (currentUserId == null or review.author.id != currentUserId)}"
      >
        <div class="preview-left">
          <div class="preview-title" th:text="${review.title}">
            Review Title
          </div>
          <div class="preview-stars">
            <div
              th:replace="fragments/stars :: review-stars(${review.rating})"
            ></div>
          </div>
        </div>
        <div>
          <p
            class="review-preview-text"
            th:text="${review.body != null and review.body.length() > 200 ? review.body.substring(0,200) + '...' : review.body}"
          >
            Review content goes here. This should be truncated.
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
